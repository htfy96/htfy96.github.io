<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>[已咕]一个脑洞：为什么需要镜像站 - int main() { return 0; }</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=author content><meta name=keywords content><link rel=canonical href=https://intmainreturn0.com/blog/why-mirror/><link rel=stylesheet type=text/css href='//fonts.googleapis.com/css?family=Lato:900,400,300'><link rel=stylesheet type=text/css href=https://intmainreturn0.com/css/combined-min.css></head><body><div class=site-wrap><header class="site-header px2 px-responsive"><div class="mt2 wrap"><div class=measure><a href=https://intmainreturn0.com class=site-title>int main() { return 0; }</a><nav class="site-nav right"><a href=https://intmainreturn0.com/about/>About</a>
<a href=https://intmainreturn0.com/tags/>Tags</a>
<a href=https://intmainreturn0.com/cv>Resume</a>
<a href=https://intmainreturn0.com/contact/>Contact</a></form></nav><div class=clearfix></div></div></div></header><div class="post p2 p-responsive wrap" role=main><div class=measure><div class="post-header mb2"><h1 class=py2>[已咕]一个脑洞：为什么需要镜像站</h1><span class=post-meta>Apr 14, 2018 by htfy96</span><br></div><article class=post-content><p>最近一直在处理 <a href=https://mirrors.sjtug.sjtu.edu.cn>https://mirrors.sjtug.sjtu.edu.cn</a> 的一些事情，突然有了一些脑洞记录下来：</p><p>镜像站的目的主要有2个：</p><ol><li>分流主源与临近的镜像源，降低带宽压力</li><li>加速用户的下载</li></ol><p>同时，镜像站的资源是有限的，主要包括：</p><ol><li>网络资源（从上游pull，向用户分发push）</li><li>硬盘资源（从上游pull时候的write，向用户分发时候的（带cache）的read）</li></ol><p>“镜像”并不一定真的要全量下载到本地硬盘，只需要对用户透明即可。根据这个定义，反代也是一种“镜像”。</p><p>这里不考虑一致性的问题，默认看到上游任何一段连续时间的文件内容都是被允许的：很多上游源（arch）已经弃疗了，有的用两阶段同步（debian）缓解问题，只有少数（kali）之类的还在push mirroring。</p><p>同时，假设push的间隔是每天一次。</p><p>目前有三种常用的“镜像”方式：全量pull、带/不带cache的反向代理。</p><p>对以上提到的目的与资源，我们希望用定量的方式来衡量：</p><ol><li>镜像前后能让主源与附近的源降低多少流量</li><li>用户下载的速度能提升多少</li><li>pull的时候每次需要多少流量？push的时候每天总共需要多少流量？</li><li>write的时候每次会写入多少？push的时候每天总共会读取多少？</li></ol><p>我们用这几个因素来衡量一下这几种方式的好坏：</p><h2 id=镜像前后能让主源与附近的源降低多少流量>镜像前后能让主源与附近的源降低多少流量</h2><p>这个问题主要取决于：</p><ol><li>这个镜像能分流多少用户（流量）？</li><li>这些用户（流量）原来会去哪？</li></ol><p>对于一个已经在运行的镜像站来说，1是可以通过观测得到的，2的话取决于镜像本身的性质：一部分用户会选择通过手动配置/auto ping选择自己最熟悉、最快的镜像站，也有一部分用户会选择中心源。</p><p>在假设</p><ol><li>这种选择和地域无关</li><li>用户在同等熟悉情况下，会选择和geoloc最接近的镜像站</li><li>用户对镜像站的熟悉程度和这个镜像站的流量成正比
的情况下：</li></ol><p>TODO&mldr;</p></article><p class=post-meta>Tags:&nbsp;
<a href=https://intmainreturn0.com/tags/%e9%95%9c%e5%83%8f>镜像</a>
,&nbsp;
<a href=https://intmainreturn0.com/tags/CDN>CDN</a></p></div></div></div><footer class=footer><div class="p2 wrap"><div class="measure mt1 center"><nav class="social-icons icons"><a class="fa fa-rss rss" href=https://intmainreturn0.com/index.xml></a>
<a class="fa fa-twitter twitter" href=https://twitter.com/HTwood96></a></nav><small>Copyright &#169; 2017<br>Powered by <a href=http://gohugo.io/ target=_blank>Hugo</a> & <a href=https://github.com/azmelanar/hugo-theme-pixyll target=_blank>Pixyll</a></small></div></div></footer><script src=https://intmainreturn0.com/js/highlight.pack.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>